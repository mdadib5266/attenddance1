<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.0/lucide.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Light gray background */
        }
        .page { display: none; }
        .active-page { display: block; }
        .nav-dropdown {
            position: absolute;
            right: 0;
            top: 100%;
            z-index: 50;
        }
        /* Custom modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            min-width: 300px;
            max-width: 500px;
        }
        /* Custom button styles for better visual appeal */
        .btn {
            @apply px-4 py-2 rounded-lg font-semibold text-white shadow-md transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-opacity-75;
        }
        .btn-primary {
            @apply bg-blue-600 hover:bg-blue-700 focus:ring-blue-500;
        }
        .btn-secondary {
            @apply bg-gray-600 hover:bg-gray-700 focus:ring-gray-500;
        }
        .btn-success {
            @apply bg-green-600 hover:bg-green-700 focus:ring-green-500;
        }
        .btn-danger {
            @apply bg-red-600 hover:bg-red-700 focus:ring-red-500;
        }
        .btn-warning {
            @apply bg-yellow-500 hover:bg-yellow-600 text-gray-800 focus:ring-yellow-400;
        }
        .card {
            @apply bg-white p-6 rounded-xl shadow-lg;
        }
        .input-field {
            @apply w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm;
        }
        .table th, .table td {
            @apply px-4 py-3 text-left border-b border-gray-200;
        }
        .table th {
            @apply bg-gray-100 text-gray-700 font-semibold;
        }
    </style>
</head>
<body class="antialiased">
    <div id="app-container" class="min-h-screen flex flex-col">

        <header class="bg-white shadow-md sticky top-0 z-40">
            <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center">
                        <a href="#" id="logoLink" class="text-2xl font-bold text-blue-600">AttendSys</a>
                    </div>
                    <div class="hidden md:block">
                        <div class="ml-10 flex items-baseline space-x-4" id="desktop-nav-links">
                            </div>
                    </div>
                    <div class="-mr-2 flex md:hidden">
                        <button type="button" id="mobile-menu-button" class="bg-gray-800 inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-white" aria-controls="mobile-menu" aria-expanded="false">
                            <span class="sr-only">Open main menu</span>
                            <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                            </svg>
                            <svg class="hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    <div class="relative hidden md:block">
                        <button id="user-menu-button" type="button" class="max-w-xs bg-gray-800 rounded-full flex items-center text-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-white" aria-expanded="false" aria-haspopup="true">
                            <span class="sr-only">Open user menu</span>
                            <img class="h-8 w-8 rounded-full" src="https://placehold.co/32x32/E0E0E0/757575?text=U" alt="User avatar">
                        </button>
                        <div id="user-menu-dropdown" class="nav-dropdown origin-top-right mt-2 w-48 rounded-md shadow-lg py-1 bg-white ring-1 ring-black ring-opacity-5 focus:outline-none hidden" role="menu" aria-orientation="vertical" aria-labelledby="user-menu-button" tabindex="-1">
                            </div>
                    </div>
                </div>
            </nav>
            <div class="md:hidden hidden" id="mobile-menu">
                <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3" id="mobile-nav-links">
                    </div>
                <div class="pt-4 pb-3 border-t border-gray-700 hidden" id="mobile-user-menu">
                     <div class="flex items-center px-5">
                        <div class="flex-shrink-0">
                            <img class="h-10 w-10 rounded-full" src="https://placehold.co/40x40/E0E0E0/757575?text=U" alt="">
                        </div>
                        <div class="ml-3">
                            <div id="mobile-user-name" class="text-base font-medium leading-none text-white">User Name</div>
                            <div id="mobile-user-email" class="text-sm font-medium leading-none text-gray-400">user@example.com</div>
                        </div>
                    </div>
                    <div class="mt-3 px-2 space-y-1" id="mobile-user-menu-links">
                        </div>
                </div>
            </div>
        </header>

        <main class="flex-grow container mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div id="page-content">
                <div id="home-logged-out-page" class="page text-center">
                    <div class="py-12">
                        <h1 class="text-5xl font-extrabold text-gray-900 sm:text-6xl md:text-7xl">
                            Streamline Your <span class="text-blue-600">Attendance</span>
                        </h1>
                        <p class="mt-6 max-w-md mx-auto text-xl text-gray-500 sm:text-2xl md:mt-8 md:max-w-3xl">
                            Effortless Attendance Management for Teachers and Students.
                        </p>
                        <div class="mt-10 max-w-md mx-auto sm:flex sm:justify-center md:mt-12">
                            <div class="rounded-md shadow">
                                <button id="homeGetStartedBtn" class="w-full flex items-center justify-center btn btn-primary text-lg">
                                    Get Started
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="mt-12 grid grid-cols-1 gap-8 sm:grid-cols-2 lg:grid-cols-3">
                        <div class="card items-center text-center">
                            <i data-lucide="users" class="w-12 h-12 text-blue-500 mx-auto mb-4"></i>
                            <h3 class="text-xl font-semibold text-gray-900">User Profiles</h3>
                            <p class="mt-2 text-gray-600">Dedicated dashboards for teachers and students.</p>
                        </div>
                        <div class="card items-center text-center">
                            <i data-lucide="toggle-right" class="w-12 h-12 text-blue-500 mx-auto mb-4"></i>
                            <h3 class="text-xl font-semibold text-gray-900">Self-Attendance</h3>
                            <p class="mt-2 text-gray-600">Teacher-controlled self-attendance options for students.</p>
                        </div>
                        <div class="card items-center text-center">
                            <i data-lucide="file-text" class="w-12 h-12 text-blue-500 mx-auto mb-4"></i>
                            <h3 class="text-xl font-semibold text-gray-900">Reporting</h3>
                            <p class="mt-2 text-gray-600">Comprehensive attendance reports for teachers.</p>
                        </div>
                    </div>
                </div>

                <div id="login-page" class="page">
                    <div class="max-w-md mx-auto mt-8 card">
                        <h2 class="text-3xl font-bold text-center text-gray-900 mb-6">Log In</h2>
                        <form id="loginForm">
                            <div class="mb-4">
                                <label for="loginEmail" class="block text-sm font-medium text-gray-700">Email Address</label>
                                <input type="email" id="loginEmail" name="email" required class="mt-1 input-field" placeholder="you@example.com">
                            </div>
                            <div class="mb-6">
                                <label for="loginPassword" class="block text-sm font-medium text-gray-700">Password</label>
                                <input type="password" id="loginPassword" name="password" required class="mt-1 input-field" placeholder="••••••••">
                                <a href="#" class="text-sm text-blue-600 hover:underline mt-1 block">Forgot Password?</a>
                            </div>
                            <div class="mb-4">
                                <label for="loginRole" class="block text-sm font-medium text-gray-700">Login as:</label>
                                <select id="loginRole" name="role" class="mt-1 input-field">
                                    <option value="student">Student</option>
                                    <option value="teacher">Teacher</option>
                                </select>
                            </div>
                            <button type="submit" class="w-full btn btn-primary">Log In</button>
                        </form>
                        <p class="mt-6 text-center text-sm text-gray-600">
                            Don't have an account? <a href="#" id="loginToRegisterLink" class="font-medium text-blue-600 hover:underline">Register Here</a>
                        </p>
                    </div>
                </div>

                <div id="registration-choice-page" class="page">
                    <div class="max-w-lg mx-auto mt-8 text-center card">
                        <h2 class="text-3xl font-bold text-gray-900 mb-8">Join Our Community</h2>
                        <div class="space-y-6">
                            <button id="registerAsTeacherBtn" class="w-full btn btn-primary text-lg py-3 group">
                                <i data-lucide="briefcase" class="w-6 h-6 mr-2 inline-block group-hover:animate-pulse"></i> Register as a Teacher
                            </button>
                            <p class="text-sm text-gray-600">Manage classes, track attendance, and empower your students.</p>
                            <button id="registerAsStudentBtn" class="w-full btn btn-success text-lg py-3 group">
                                <i data-lucide="graduation-cap" class="w-6 h-6 mr-2 inline-block group-hover:animate-bounce"></i> Register as a Student
                            </button>
                            <p class="text-sm text-gray-600">View your schedule and mark your attendance easily.</p>
                        </div>
                        <p class="mt-8 text-center text-sm text-gray-600">
                            Already have an account? <a href="#" id="choiceToLoginLink" class="font-medium text-blue-600 hover:underline">Log In</a>
                        </p>
                    </div>
                </div>

                <div id="teacher-registration-page" class="page">
                    <div class="max-w-md mx-auto mt-8 card">
                        <h2 class="text-3xl font-bold text-center text-gray-900 mb-6">Register as a Teacher</h2>
                        <form id="teacherRegisterForm">
                            <div class="mb-4">
                                <label for="teacherFullName" class="block text-sm font-medium text-gray-700">Full Name</label>
                                <input type="text" id="teacherFullName" required class="mt-1 input-field" placeholder="Dr. Jane Doe">
                            </div>
                            <div class="mb-4">
                                <label for="teacherEmail" class="block text-sm font-medium text-gray-700">Email Address</label>
                                <input type="email" id="teacherEmail" required class="mt-1 input-field" placeholder="jane.doe@school.edu">
                            </div>
                            <div class="mb-4">
                                <label for="teacherPassword" class="block text-sm font-medium text-gray-700">Password</label>
                                <input type="password" id="teacherPassword" required class="mt-1 input-field" placeholder="••••••••">
                            </div>
                            <div class="mb-4">
                                <label for="teacherConfirmPassword" class="block text-sm font-medium text-gray-700">Confirm Password</label>
                                <input type="password" id="teacherConfirmPassword" required class="mt-1 input-field" placeholder="••••••••">
                            </div>
                            <div class="mb-4">
                                <label for="teacherEmployeeId" class="block text-sm font-medium text-gray-700">Employee ID (Optional)</label>
                                <input type="text" id="teacherEmployeeId" class="mt-1 input-field" placeholder="T-12345">
                            </div>
                            <div class="flex items-center mb-6">
                                <input id="teacherTerms" type="checkbox" required class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                <label for="teacherTerms" class="ml-2 block text-sm text-gray-900">I agree to the <a href="#" class="text-blue-600 hover:underline">Terms and Conditions</a></label>
                            </div>
                            <button type="submit" class="w-full btn btn-primary">Register</button>
                        </form>
                        <p class="mt-6 text-center text-sm text-gray-600">
                            Already have an account? <a href="#" id="teacherRegToLoginLink" class="font-medium text-blue-600 hover:underline">Log In</a>
                        </p>
                    </div>
                </div>

                <div id="student-registration-page" class="page">
                     <div class="max-w-md mx-auto mt-8 card">
                        <h2 class="text-3xl font-bold text-center text-gray-900 mb-6">Register as a Student</h2>
                        <form id="studentRegisterForm">
                            <div class="mb-4">
                                <label for="studentFullName" class="block text-sm font-medium text-gray-700">Full Name</label>
                                <input type="text" id="studentFullName" required class="mt-1 input-field" placeholder="John Smith">
                            </div>
                            <div class="mb-4">
                                <label for="studentEmail" class="block text-sm font-medium text-gray-700">Email Address</label>
                                <input type="email" id="studentEmail" required class="mt-1 input-field" placeholder="john.smith@example.com">
                            </div>
                            <div class="mb-4">
                                <label for="studentPassword" class="block text-sm font-medium text-gray-700">Password</label>
                                <input type="password" id="studentPassword" required class="mt-1 input-field" placeholder="••••••••">
                            </div>
                            <div class="mb-4">
                                <label for="studentConfirmPassword" class="block text-sm font-medium text-gray-700">Confirm Password</label>
                                <input type="password" id="studentConfirmPassword" required class="mt-1 input-field" placeholder="••••••••">
                            </div>
                            <div class="mb-4">
                                <label for="studentIdNumber" class="block text-sm font-medium text-gray-700">Student ID / Roll Number (Optional)</label>
                                <input type="text" id="studentIdNumber" class="mt-1 input-field" placeholder="S-67890">
                            </div>
                             <div class="flex items-center mb-6">
                                <input id="studentTerms" type="checkbox" required class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                <label for="studentTerms" class="ml-2 block text-sm text-gray-900">I agree to the <a href="#" class="text-blue-600 hover:underline">Terms and Conditions</a></label>
                            </div>
                            <button type="submit" class="w-full btn btn-success">Register</button>
                        </form>
                        <p class="mt-6 text-center text-sm text-gray-600">
                            Already have an account? <a href="#" id="studentRegToLoginLink" class="font-medium text-blue-600 hover:underline">Log In</a>
                        </p>
                    </div>
                </div>

                <div id="teacher-dashboard-page" class="page">
                    <div class="mb-6 flex justify-between items-center">
                        <h2 class="text-3xl font-bold text-gray-900">Teacher Dashboard</h2>
                        <p id="teacherUserId" class="text-sm text-gray-500"></p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="card md:col-span-2 lg:col-span-1">
                            <h3 class="text-xl font-semibold text-gray-800 mb-4">Upcoming Classes</h3>
                            <ul class="space-y-3">
                                <li class="p-3 bg-blue-50 rounded-lg">
                                    <p class="font-medium text-blue-700">Mathematics 101 - 09:00 AM</p>
                                    <button class="text-xs btn btn-primary mt-1 py-1 px-2">Manage Attendance</button>
                                </li>
                                <li class="p-3 bg-green-50 rounded-lg">
                                    <p class="font-medium text-green-700">Physics 202 - 11:00 AM</p>
                                    <button class="text-xs btn btn-primary mt-1 py-1 px-2">Manage Attendance</button>
                                </li>
                            </ul>
                        </div>

                        <div class="card">
                            <h3 class="text-xl font-semibold text-gray-800 mb-4">Self-Attendance: Mathematics 101</h3>
                            <div class="space-y-3">
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-700">Enable Self-Attendance:</span>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="selfAttendanceToggle" class="sr-only peer">
                                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                                <div id="selfAttendanceDuration" class="hidden">
                                    <label for="attendanceDuration" class="block text-sm font-medium text-gray-700">Duration (minutes):</label>
                                    <input type="number" id="attendanceDuration" value="15" class="mt-1 input-field w-1/2">
                                </div>
                                <p id="selfAttendanceStatus" class="text-sm text-gray-600">Status: <span class="font-semibold">Disabled</span></p>
                                <button id="forceDisableBtn" class="btn btn-warning text-sm py-1 px-3 hidden">Force Disable Now</button>
                            </div>
                        </div>

                        <div class="card">
                            <h3 class="text-xl font-semibold text-gray-800 mb-4">Quick Actions</h3>
                            <div class="space-y-3">
                                <button class="w-full btn btn-primary">Create New Class</button>
                                <button class="w-full btn btn-secondary">View All Classes</button>
                                <button class="w-full btn btn-info bg-teal-500 hover:bg-teal-600 focus:ring-teal-400">Generate Reports</button>
                            </div>
                        </div>
                         <div class="card md:col-span-2 lg:col-span-3">
                            <h3 class="text-xl font-semibold text-gray-800 mb-4">Student Roster: Mathematics 101</h3>
                            <div class="overflow-x-auto">
                                <table class="min-w-full table">
                                    <thead>
                                        <tr>
                                            <th>Student Name</th>
                                            <th>Student ID</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Alice Wonderland</td>
                                            <td>S-1001</td>
                                            <td><span class="px-2 py-1 text-xs font-semibold text-green-700 bg-green-100 rounded-full">Present</span></td>
                                            <td><button class="text-xs btn btn-secondary py-1 px-2">Edit</button></td>
                                        </tr>
                                        <tr>
                                            <td>Bob The Builder</td>
                                            <td>S-1002</td>
                                            <td><span class="px-2 py-1 text-xs font-semibold text-red-700 bg-red-100 rounded-full">Absent</span></td>
                                            <td><button class="text-xs btn btn-secondary py-1 px-2">Edit</button></td>
                                        </tr>
                                        <tr>
                                            <td>Charlie Brown</td>
                                            <td>S-1003</td>
                                            <td><span class="px-2 py-1 text-xs font-semibold text-yellow-700 bg-yellow-100 rounded-full">Late</span></td>
                                            <td><button class="text-xs btn btn-secondary py-1 px-2">Edit</button></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="student-dashboard-page" class="page">
                     <div class="mb-6 flex justify-between items-center">
                        <h2 class="text-3xl font-bold text-gray-900">Student Dashboard</h2>
                        <p id="studentUserId" class="text-sm text-gray-500"></p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="card">
                            <h3 class="text-xl font-semibold text-gray-800 mb-4">Upcoming Classes</h3>
                             <ul class="space-y-3">
                                <li class="p-3 bg-indigo-50 rounded-lg">
                                    <p class="font-medium text-indigo-700">History 101 - 10:00 AM</p>
                                    <p class="text-xs text-gray-500">Room 203</p>
                                </li>
                                <li class="p-3 bg-pink-50 rounded-lg">
                                    <p class="font-medium text-pink-700">Art Appreciation - 01:00 PM</p>
                                     <p class="text-xs text-gray-500">Studio B</p>
                                </li>
                            </ul>
                        </div>

                        <div class="card">
                            <h3 class="text-xl font-semibold text-gray-800 mb-4">Attendance: History 101</h3>
                            <div id="selfAttendancePrompt" class="text-center">
                                <p class="text-gray-600 mb-4">Self-attendance is currently <strong class="text-red-600">CLOSED</strong> for History 101.</p>
                                <p class="text-sm text-gray-500">Your teacher will mark your attendance.</p>
                                <!-- Example when open:
                                <p class="text-green-600 font-semibold mb-2">Self-Attendance is OPEN for History 101!</p>
                                <p class="text-sm text-gray-500 mb-4">You have 10 minutes remaining.</p>
                                <button class="btn btn-success text-lg">Mark Myself Present</button>
                                -->
                            </div>
                        </div>

                        <div class="card md:col-span-2">
                             <h3 class="text-xl font-semibold text-gray-800 mb-4">Recent Attendance</h3>
                             <ul class="space-y-2">
                                <li class="flex justify-between items-center p-2 border-b">
                                    <span>Physics 202 (Yesterday)</span>
                                    <span class="px-2 py-1 text-xs font-semibold text-green-700 bg-green-100 rounded-full">Present</span>
                                </li>
                                <li class="flex justify-between items-center p-2 border-b">
                                    <span>Mathematics 101 (Yesterday)</span>
                                     <span class="px-2 py-1 text-xs font-semibold text-green-700 bg-green-100 rounded-full">Present</span>
                                </li>
                                 <li class="flex justify-between items-center p-2">
                                    <span>English Lit (2 days ago)</span>
                                     <span class="px-2 py-1 text-xs font-semibold text-red-700 bg-red-100 rounded-full">Absent</span>
                                </li>
                             </ul>
                             <button class="mt-4 text-sm btn btn-secondary py-1 px-3">View Full Attendance History</button>
                        </div>
                    </div>
                </div>

                 <div id="profile-page" class="page">
                    <div class="max-w-2xl mx-auto mt-8 card">
                        <h2 class="text-3xl font-bold text-gray-900 mb-6">My Profile</h2>
                        <div id="profileInfoDisplay" class="mb-6 border-b pb-6">
                            <h3 class="text-xl font-semibold text-gray-800 mb-3">Profile Information</h3>
                            <p><strong>Name:</strong> <span id="profileName"></span></p>
                            <p><strong>Email:</strong> <span id="profileEmail"></span></p>
                            <p id="profileRoleSpecificInfo"> </p>
                            <p><strong>User ID:</strong> <span id="profileUserId" class="text-xs text-gray-500"></span></p>
                        </div>

                        <div id="changePasswordSection">
                            <h3 class="text-xl font-semibold text-gray-800 mb-3">Change Password</h3>
                            <form id="changePasswordForm">
                                <div class="mb-4">
                                    <label for="currentPassword" class="block text-sm font-medium text-gray-700">Current Password</label>
                                    <input type="password" id="currentPassword" required class="mt-1 input-field">
                                </div>
                                <div class="mb-4">
                                    <label for="newPassword" class="block text-sm font-medium text-gray-700">New Password</label>
                                    <input type="password" id="newPassword" required class="mt-1 input-field">
                                </div>
                                <div class="mb-6">
                                    <label for="confirmNewPassword" class="block text-sm font-medium text-gray-700">Confirm New Password</label>
                                    <input type="password" id="confirmNewPassword" required class="mt-1 input-field">
                                </div>
                                <button type="submit" class="btn btn-primary">Change Password</button>
                            </form>
                        </div>
                    </div>
                </div>

            </div> </main>

        <footer class="bg-gray-800 text-white text-center p-6 mt-auto">
            <p>&copy; <span id="currentYear"></span> AttendSys. All rights reserved.</p>
            <p class="text-sm text-gray-400">A simplified prototype for demonstration.</p>
        </footer>

    </div> <div id="messageModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3 id="modalTitle" class="text-xl font-semibold mb-2">Notification</h3>
            <p id="modalMessage" class="text-gray-700 mb-4"></p>
            <button id="modalCloseBtn" class="btn btn-primary">Close</button>
        </div>
    </div>


    <script type="module">
        // --- Application State (Global) ---
        let currentPageId = 'home-logged-out-page';
        let loggedInUser = null; 

        // --- Firebase Placeholder (Global) ---
        // ... (Firebase config and init placeholders would go here if used)

        document.addEventListener('DOMContentLoaded', () => {
            // --- UI Elements (Defined after DOM is ready) ---
            const pages = document.querySelectorAll('.page');
            const logoLink = document.getElementById('logoLink');
            const desktopNavLinks = document.getElementById('desktop-nav-links');
            const mobileNavLinks = document.getElementById('mobile-nav-links');
            const userMenuButton = document.getElementById('user-menu-button');
            const userMenuDropdown = document.getElementById('user-menu-dropdown');
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            const mobileUserMenu = document.getElementById('mobile-user-menu');
            const mobileUserName = document.getElementById('mobile-user-name');
            const mobileUserEmail = document.getElementById('mobile-user-email');
            const mobileUserMenuLinks = document.getElementById('mobile-user-menu-links');
            
            const homeGetStartedBtn = document.getElementById('homeGetStartedBtn');
            
            const loginForm = document.getElementById('loginForm');
            const loginToRegisterLink = document.getElementById('loginToRegisterLink');
            
            const registerAsTeacherBtn = document.getElementById('registerAsTeacherBtn');
            const registerAsStudentBtn = document.getElementById('registerAsStudentBtn');
            const choiceToLoginLink = document.getElementById('choiceToLoginLink');
            
            const teacherRegisterForm = document.getElementById('teacherRegisterForm');
            const teacherRegToLoginLink = document.getElementById('teacherRegToLoginLink');
            
            const studentRegisterForm = document.getElementById('studentRegisterForm');
            const studentRegToLoginLink = document.getElementById('studentRegToLoginLink');
            
            const selfAttendanceToggle = document.getElementById('selfAttendanceToggle');
            const selfAttendanceDurationDiv = document.getElementById('selfAttendanceDuration');
            const selfAttendanceStatus = document.getElementById('selfAttendanceStatus');
            const forceDisableBtn = document.getElementById('forceDisableBtn');
            const teacherUserIdElement = document.getElementById('teacherUserId');
            
            const selfAttendancePrompt = document.getElementById('selfAttendancePrompt');
            const studentUserIdElement = document.getElementById('studentUserId');
            
            const profileName = document.getElementById('profileName');
            const profileEmail = document.getElementById('profileEmail');
            const profileRoleSpecificInfo = document.getElementById('profileRoleSpecificInfo');
            const profileUserId = document.getElementById('profileUserId');
            const changePasswordForm = document.getElementById('changePasswordForm');
            
            const messageModal = document.getElementById('messageModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalMessage = document.getElementById('modalMessage');
            const modalCloseBtn = document.getElementById('modalCloseBtn');
            const currentYearEl = document.getElementById('currentYear');

            // --- Locally Scoped Utility Functions (Accessing elements defined above) ---
            function localShowPage(pageId) {
                if (!pages) return; // Guard clause
                pages.forEach(page => {
                    if (page.id === pageId) {
                        page.classList.add('active-page');
                        page.classList.remove('hidden');
                    } else {
                        page.classList.remove('active-page');
                        page.classList.add('hidden');
                    }
                });
                currentPageId = pageId; // Update global state
                window.scrollTo(0, 0);

                if (mobileMenu) {
                    mobileMenu.classList.add('hidden');
                } else {
                    console.error("localShowPage: mobileMenu element not found!");
                }
                if (mobileMenuButton) {
                    mobileMenuButton.setAttribute('aria-expanded', 'false');
                    const firstSvg = mobileMenuButton.querySelector('svg:first-child');
                    const lastSvg = mobileMenuButton.querySelector('svg:last-child');
                    if (firstSvg) firstSvg.classList.remove('hidden');
                    if (lastSvg) lastSvg.classList.add('hidden');
                } else {
                     console.error("localShowPage: mobileMenuButton element not found!");
                }
            }

            function localShowMessageModal(title, message) {
                if (modalTitle) modalTitle.textContent = title;
                if (modalMessage) modalMessage.textContent = message;
                if (messageModal) messageModal.classList.remove('hidden');
            }

            function localCloseMessageModal() {
                if (messageModal) messageModal.classList.add('hidden');
            }

            function localUpdateNavigation() {
                let desktopLinksHtml = '';
                let mobileLinksHtml = '';
                let userDropdownHtml = '';
                let mobileUserLinksHtml = '';

                const commonDesktopClass = "text-gray-700 hover:bg-gray-200 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium cursor-pointer";
                const commonMobileClass = "block text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-base font-medium cursor-pointer";
                const commonDropdownClass = "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer";

                desktopLinksHtml += `<a data-page="home-logged-out-page" class="${commonDesktopClass}">Home</a>`;
                mobileLinksHtml += `<a data-page="home-logged-out-page" class="${commonMobileClass}">Home</a>`;

                if (loggedInUser) { // global loggedInUser
                    desktopLinksHtml += `<a data-page="${loggedInUser.type === 'teacher' ? 'teacher-dashboard-page' : 'student-dashboard-page'}" class="${commonDesktopClass}">Dashboard</a>`;
                    mobileLinksHtml += `<a data-page="${loggedInUser.type === 'teacher' ? 'teacher-dashboard-page' : 'student-dashboard-page'}" class="${commonMobileClass}">Dashboard</a>`;
                    
                    userDropdownHtml += `<a data-page="profile-page" class="${commonDropdownClass}" role="menuitem" tabindex="-1" id="user-menu-item-0">Your Profile</a>`;
                    userDropdownHtml += `<a id="logoutButtonDropdown" class="${commonDropdownClass}" role="menuitem" tabindex="-1">Sign out</a>`;
                    
                    mobileUserLinksHtml += `<a data-page="profile-page" class="block rounded-md px-3 py-2 text-base font-medium text-gray-400 hover:bg-gray-700 hover:text-white cursor-pointer">Your Profile</a>`;
                    mobileUserLinksHtml += `<a id="logoutButtonMobile" class="block rounded-md px-3 py-2 text-base font-medium text-gray-400 hover:bg-gray-700 hover:text-white cursor-pointer">Sign out</a>`;

                    if (userMenuButton) userMenuButton.classList.remove('hidden');
                    if (mobileUserMenu) mobileUserMenu.classList.remove('hidden');
                    if (mobileUserName) mobileUserName.textContent = loggedInUser.name;
                    if (mobileUserEmail) mobileUserEmail.textContent = loggedInUser.email;
                    if (loggedInUser.avatar && userMenuButton) {
                        const img = userMenuButton.querySelector('img');
                        if (img) img.src = loggedInUser.avatar;
                    }
                } else {
                    desktopLinksHtml += `<a data-page="login-page" class="${commonDesktopClass}">Log In</a>`;
                    desktopLinksHtml += `<a data-page="registration-choice-page" class="bg-blue-600 text-white hover:bg-blue-700 px-3 py-2 rounded-md text-sm font-medium cursor-pointer">Register</a>`;
                    
                    mobileLinksHtml += `<a data-page="login-page" class="${commonMobileClass}">Log In</a>`;
                    mobileLinksHtml += `<a data-page="registration-choice-page" class="${commonMobileClass} bg-blue-500 text-white">Register</a>`;
                    
                    if (userMenuButton) userMenuButton.classList.add('hidden');
                    if (userMenuDropdown) userMenuDropdown.classList.add('hidden');
                    if (mobileUserMenu) mobileUserMenu.classList.add('hidden');
                }

                if (desktopNavLinks) desktopNavLinks.innerHTML = desktopLinksHtml;
                if (mobileNavLinks) mobileNavLinks.innerHTML = mobileLinksHtml;
                if (userMenuDropdown) userMenuDropdown.innerHTML = userDropdownHtml;
                if (mobileUserMenuLinks) mobileUserMenuLinks.innerHTML = mobileUserLinksHtml;

                document.querySelectorAll('#desktop-nav-links a, #mobile-nav-links a, #user-menu-dropdown a, #mobile-user-menu-links a').forEach(link => {
                    if (link.id === 'logoutButtonDropdown' || link.id === 'logoutButtonMobile') {
                        link.addEventListener('click', localHandleLogout);
                    } else if (link.dataset.page) {
                        link.addEventListener('click', (e) => {
                            e.preventDefault();
                            localShowPage(link.dataset.page);
                            if (userMenuDropdown) userMenuDropdown.classList.add('hidden');
                        });
                    }
                });
            }

            function localHandleLogout() {
                loggedInUser = null;
                localUpdateNavigation();
                localShowPage('home-logged-out-page');
                if (userMenuDropdown) userMenuDropdown.classList.add('hidden');
                localShowMessageModal("Logged Out", "You have been successfully logged out.");
            }

            function localPopulateProfilePage() {
                if (loggedInUser && currentPageId === 'profile-page') {
                    if (profileName) profileName.textContent = loggedInUser.name;
                    if (profileEmail) profileEmail.textContent = loggedInUser.email;
                    if (profileUserId) profileUserId.textContent = loggedInUser.id;
                    if (profileRoleSpecificInfo) {
                        if (loggedInUser.type === 'teacher') {
                            profileRoleSpecificInfo.innerHTML = `<strong>Employee ID:</strong> T-${loggedInUser.id.substring(0,5)}`;
                        } else {
                            profileRoleSpecificInfo.innerHTML = `<strong>Student ID:</strong> S-${loggedInUser.id.substring(0,5)}`;
                        }
                    }
                }
            }

            // --- Event Handlers Setup (Check if elements exist before attaching) ---
            if (logoLink) {
                logoLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    localShowPage(loggedInUser ? (loggedInUser.type === 'teacher' ? 'teacher-dashboard-page' : 'student-dashboard-page') : 'home-logged-out-page');
                });
            }

            if (homeGetStartedBtn) {
                homeGetStartedBtn.addEventListener('click', () => localShowPage('registration-choice-page'));
            }

            if (loginForm) {
                loginForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const email = loginForm.email.value;
                    const role = loginForm.role.value;
                    loggedInUser = {
                        id: role === 'teacher' ? 'teacher-' + Date.now() : 'student-' + Date.now(),
                        name: role === 'teacher' ? 'Dr. ' + email.split('@')[0] : email.split('@')[0],
                        email: email,
                        type: role,
                        avatar: `https://placehold.co/40x40/E0E0E0/757575?text=${email.charAt(0).toUpperCase()}`
                    };
                    localUpdateNavigation();
                    if (role === 'teacher') {
                        if (teacherUserIdElement) teacherUserIdElement.textContent = `User ID: ${loggedInUser.id}`;
                        localShowPage('teacher-dashboard-page');
                    } else {
                        if (studentUserIdElement) studentUserIdElement.textContent = `User ID: ${loggedInUser.id}`;
                        const isSelfAttendanceOpen = Math.random() < 0.5;
                        if (selfAttendancePrompt) {
                            if (isSelfAttendanceOpen) {
                                selfAttendancePrompt.innerHTML = `
                                    <p class="text-green-600 font-semibold mb-2">Self-Attendance is OPEN for History 101!</p>
                                    <p class="text-sm text-gray-500 mb-4">You have ${Math.floor(Math.random() * 15) + 5} minutes remaining.</p>
                                    <button class="btn btn-success text-lg">Mark Myself Present</button>
                                `;
                            } else {
                                 selfAttendancePrompt.innerHTML = `
                                    <p class="text-gray-600 mb-4">Self-attendance is currently <strong class="text-red-600">CLOSED</strong> for History 101.</p>
                                    <p class="text-sm text-gray-500">Your teacher will mark your attendance.</p>
                                `;
                            }
                        }
                        localShowPage('student-dashboard-page');
                    }
                    loginForm.reset();
                    localShowMessageModal("Login Successful", `Welcome, ${loggedInUser.name}!`);
                });
            }
            
            if(loginToRegisterLink) loginToRegisterLink.addEventListener('click', (e) => { e.preventDefault(); localShowPage('registration-choice-page'); });
            if(choiceToLoginLink) choiceToLoginLink.addEventListener('click', (e) => { e.preventDefault(); localShowPage('login-page'); });
            if(teacherRegToLoginLink) teacherRegToLoginLink.addEventListener('click', (e) => { e.preventDefault(); localShowPage('login-page'); });
            if(studentRegToLoginLink) studentRegToLoginLink.addEventListener('click', (e) => { e.preventDefault(); localShowPage('login-page'); });

            if(registerAsTeacherBtn) registerAsTeacherBtn.addEventListener('click', () => localShowPage('teacher-registration-page'));
            if(registerAsStudentBtn) registerAsStudentBtn.addEventListener('click', () => localShowPage('student-registration-page'));

            if(teacherRegisterForm) teacherRegisterForm.addEventListener('submit', (e) => {
                e.preventDefault();
                localShowMessageModal("Registration Successful", "Teacher account created (simulated). Please log in.");
                teacherRegisterForm.reset();
                localShowPage('login-page');
            });

            if(studentRegisterForm) studentRegisterForm.addEventListener('submit', (e) => {
                e.preventDefault();
                localShowMessageModal("Registration Successful", "Student account created (simulated). Please log in.");
                studentRegisterForm.reset();
                localShowPage('login-page');
            });

            if (selfAttendanceToggle) {
                selfAttendanceToggle.addEventListener('change', () => {
                    const isEnabled = selfAttendanceToggle.checked;
                    if (selfAttendanceDurationDiv) selfAttendanceDurationDiv.classList.toggle('hidden', !isEnabled);
                    if (forceDisableBtn) forceDisableBtn.classList.toggle('hidden', !isEnabled);
                    if (selfAttendanceStatus) selfAttendanceStatus.innerHTML = `Status: <span class="font-semibold">${isEnabled ? 'ENABLED' : 'DISABLED'}</span>`;
                    localShowMessageModal("Self-Attendance", `Self-attendance ${isEnabled ? 'enabled' : 'disabled'} for Mathematics 101.`);
                });
            }
            if (forceDisableBtn) {
                forceDisableBtn.addEventListener('click', () => {
                    if (selfAttendanceToggle) {
                        selfAttendanceToggle.checked = false;
                        selfAttendanceToggle.dispatchEvent(new Event('change'));
                    }
                });
            }

            if (changePasswordForm) {
                changePasswordForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const newPass = document.getElementById('newPassword').value;
                    const confirmNewPass = document.getElementById('confirmNewPassword').value;
                    if (newPass !== confirmNewPass) {
                        localShowMessageModal("Password Change Error", "New passwords do not match.");
                        return;
                    }
                    if (newPass.length < 6) {
                        localShowMessageModal("Password Change Error", "New password must be at least 6 characters long.");
                        return;
                    }
                    localShowMessageModal("Password Change", "Password change simulated successfully.");
                    changePasswordForm.reset();
                });
            }
            
            // Global click listener for profile page population (delegated)
            document.addEventListener('click', (e) => {
                if (e.target.matches('[data-page="profile-page"]') || e.target.closest('[data-page="profile-page"]')) {
                     if (loggedInUser) localPopulateProfilePage();
                }
            });

            if (mobileMenuButton) {
                mobileMenuButton.addEventListener('click', () => {
                    const expanded = mobileMenuButton.getAttribute('aria-expanded') === 'true' || false;
                    mobileMenuButton.setAttribute('aria-expanded', !expanded);
                    if (mobileMenu) mobileMenu.classList.toggle('hidden');
                    const firstSvg = mobileMenuButton.querySelector('svg:first-child');
                    const lastSvg = mobileMenuButton.querySelector('svg:last-child');
                    if (firstSvg) firstSvg.classList.toggle('hidden');
                    if (lastSvg) lastSvg.classList.toggle('hidden');
                });
            }
            
            if (userMenuButton) {
                userMenuButton.addEventListener('click', () => {
                    if (userMenuDropdown) userMenuDropdown.classList.toggle('hidden');
                });
            }
            // Global click for closing user dropdown (delegated)
            document.addEventListener('click', (event) => {
                if (userMenuButton && userMenuDropdown && !userMenuButton.contains(event.target) && !userMenuDropdown.contains(event.target)) {
                    userMenuDropdown.classList.add('hidden');
                }
            });

            if (modalCloseBtn) {
                modalCloseBtn.addEventListener('click', localCloseMessageModal);
            }

            // --- Initial Execution ---
            localUpdateNavigation();
            localShowPage('home-logged-out-page'); 

            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            } else {
                console.error("Lucide library not found. Icons will not be rendered.");
            }
            if(currentYearEl) {
                currentYearEl.textContent = new Date().getFullYear();
            }
        });
    </script>
</body>
</html>
